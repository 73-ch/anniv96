{"version":3,"file":"pre_animation-00c6acf3a13249aba6ae.js","sources":["webpack:///webpack/bootstrap 1b1e0ff9b36b47129316","webpack:///app/javascript/packs/pre_animation.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/packs/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1b1e0ff9b36b47129316","'use strict'\nexport default class {\n    constructor(mobile_flag, texture, json, callback) {\n        this.texture = texture;\n        this.window_size = [window.innerWidth, window.innerHeight];\n\n        this.wind_data = json;\n\n        this.counter = 0;\n\n        this.threshold = mobile_flag ? 0.02 : 0.0082;\n        this.mobile_power = mobile_flag ? 0.002 : 0.001;\n\n        this.renderer = new THREE.WebGLRenderer({antialias: true});\n\n        this.renderer.setPixelRatio(window.devicePixelRatio);\n        this.renderer.setSize(this.window_size[0], this.window_size[1]);\n\n        this.move_rad = 0;\n\n        this.logoLayer();\n\n        this.layerBlend();\n\n        const wrapper = document.querySelector(\".top-content\");\n        wrapper.appendChild(this.renderer.domElement);\n\n        this.update();\n\n        callback();\n\n        // Three.js Inspector debug\n        window.scene = this.final.scene;\n\n        window.scene = this.logo.scene;\n\n        this.resizeCanvas();\n    }\n\n    update() {\n        let d = this.wind_data[this.counter];\n\n        let power = Math.exp(2 - Math.abs(Math.cos(d.direction) - Math.cos(this.move_rad))) * 0.5;\n\n        this.final.material.uniforms.wind.value = new THREE.Vector2(d.direction, d.velocity * this.mobile_power * power);\n\n        this.counter++;\n\n        if (this.counter >= this.wind_data.length) this.counter = 0;\n\n        this.draw(() => {\n            requestAnimationFrame(this.update.bind(this));\n        });\n    }\n\n    draw(callback) {\n        this.renderer.render(this.logo.scene, this.logo.camera, this.logo.rt);\n\n        // this.renderer.render(this.logo.scene, this.logo.camera);\n\n        this.final.material.uniforms['texture'].value = this.logo.rt.texture;\n\n        this.renderer.render(this.final.scene, this.final.camera);\n        // console.log(this.logo.rt.texture);\n        callback();\n\n\n    }\n\n    logoLayer() {\n        this.logo = {};\n        this.logo.rt = new THREE.WebGLRenderTarget(this.window_size[0], this.window_size[1], {\n            minFilter: THREE.LinearFilter,\n            magFilter: THREE.NearestFilter,\n            format: THREE.RGBFormat\n        });\n\n\n        this.logo.scene = new THREE.Scene();\n\n        this.logo.camera = new THREE.PerspectiveCamera(45, this.window_size[0] / this.window_size[1], 1, 10000);\n        this.logo.camera.position.set(0, 0, 1000);\n\n\n        this.createLogo();\n\n        this.logo.light = new THREE.DirectionalLight(0xffffff);\n        this.logo.light.position.set(1, 1, 1);\n\n        this.logo.scene.add(this.logo.light);\n    }\n\n\n    createLogo() {\n        this.logo.geometry = new THREE.PlaneGeometry(30, 30);\n        let plane_material = new THREE.MeshBasicMaterial({\n            map: this.texture\n        });\n\n        this.logo.obj = new THREE.Mesh(this.logo.geometry, plane_material);\n\n        console.log(this.logo.obj);\n\n        this.logo.scene.add(this.logo.obj);\n    }\n\n    layerBlend() {\n        this.final = {};\n\n        this.final.scene = new THREE.Scene();\n\n        this.final.camera = new THREE.PerspectiveCamera(45, this.window_size[0] / this.window_size[1], 1, 10000);\n        this.final.camera.position.set(0, 0, 1000);\n\n        this.final.material = new THREE.ShaderMaterial({\n            fragmentShader: document.getElementById('fs').innerHTML,\n            vertexShader: document.getElementById('vs').innerHTML,\n            uniforms: {\n                texture: {\n                    type: \"t\",\n                    value: this.logo.rt.texture\n                },\n                wind: {\n                    type: \"v2\",\n                    value: new THREE.Vector2(this.wind_data[0].direction, this.wind_data[0].velocity * this.power)\n                }\n            }\n        });\n\n        this.final.geometry = new THREE.PlaneGeometry(this.window_size[0], this.window_size[1], 1, 1);\n        this.final.plane = new THREE.Mesh(this.final.geometry, this.final.material);\n\n        this.final.scene.add(this.final.plane);\n    }\n\n    resizeCanvas() {\n        this.window_size = [window.innerWidth, window.innerHeight - 60];\n\n        this.renderer.setPixelRatio(window.devicePixelRatio);\n        this.renderer.setSize(this.window_size[0], this.window_size[1]);\n\n        this.logo.rt.setSize(this.window_size[0], this.window_size[1]);\n        // this.logo.rt.setPixelRatio(window.devecePixecRatio);\n\n        this.logo.camera.aspect = this.window_size[0] / this.window_size[1];\n        // this.logo.camera.position.set(0, 0, 2000 - (this.window_size[0] > this.window_size[1]? this.window_size[0] : this.window_size[1]) *1.75);\n        this.logo.camera.updateProjectionMatrix();\n\n        // console.log(this.window_size[0] < this.window_size[1]? this.window_size[0] : this.window_size[1]);\n\n        console.log(this.logo.obj);\n\n        let size = (this.window_size[0] < this.window_size[1] ? this.window_size[0] : this.window_size[1]) * this.threshold;\n\n        this.logo.obj.scale.set(size, size, size);\n        // this.final.camera.aspect = this.window_size[0] / this.window_size[1];\n        // this.final.camera.updateProjectionMatrix();\n    }\n\n    actionDevise(e) {\n        // this.power =\n    }\n\n    mouseMove(e) {\n        // console.log();\n        this.move_rad = Math.atan2(e.clientX / this.window_size[0] * 2 - 1, e.clientY / this.window_size[1] * (-2) + 1);\n        this.move_rad += this.move_rad < 0 ? Math.PI * 2 : 0;\n\n    }\n\n    deviseOrientation(e) {\n        this.move_rad = e.alpha / 360 * Math.PI;\n    }\n\n}\n\n\n\n\n// WEBPACK FOOTER //\n// app/javascript/packs/pre_animation.js"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC7DA;AAAA;AACA;;;;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAMA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AALA;AAHA;AACA;AAcA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AAEA;;;AAEA;AACA;AACA;;;;;;;;;A","sourceRoot":""}